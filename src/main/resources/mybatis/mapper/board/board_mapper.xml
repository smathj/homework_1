<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.homework.mybatis.board.BoardDao">

    <!-- 게시글 조회 -->
    <select id="list" resultType="board">
        select B.seq,
               B.title,
               CASE U.account_type
                   when 'LESSOR' then concat(U.nickname,'(','임대인', ') 사용자')
                   when 'REALTOR' then concat(U.nickname,'(','공인 중개사', ') 사용자')
                   when 'LESSEE' then concat(U.nickname,'(','임차인', ') 사용자')
                   END as full_name,
               B.content,
               B.writer,
               B.likes,
               B.create_date,
               B.update_date
        from board B
        left join user U
         on B.writer = U.id
        where B.delete_yn = 0
    </select>


    <select id="boardFindBySeq" resultType="board">
        select *
        from board
        where seq=#{seq}
    </select>

    <select id="boardCountFindBySeq" resultType="int">
        select count(*)
        from board
        where seq=#{seq}
    </select>

    <select id="boardCountFindBySeqAndWriter" resultType="int">
        select count(*)
        from board
        where seq    = #{seq}
         and  writer = #{writer}
    </select>

    <insert id="boardCreate" parameterType="board">
        insert into board(title, content, writer) values
        (#{title}, #{content}, #{writer})
    </insert>


    <update id="boardUpdate" parameterType="board">
        update board
         set  title    = #{title},
              content  = #{content}
        where seq    = #{seq}
         and  writer = #{writer}
    </update>


    <update id="boardLike" parameterType="board">
        update board
         set likes = #{likes}
        where seq  = #{seq}
    </update>


    <update id="boardDelete" parameterType="board">
        update board
        set delete_date = #{delete_date}
            delete_yn   = 1
        where seq    = #{seq}
         and writer = #{writer}
    </update>
</mapper>